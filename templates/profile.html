<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>MY PROFILE</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!-- Home ë²„íŠ¼ -->
    <a href="/" class="home-button">Home</a>

    <header>
        <h1>{{ user_name }}ë‹˜ì˜ <span class="highlight">PROFILE</span></h1>
    </header>
    <main>
        <section>
            <h2>ğŸŒ¸ í”„ë¡œí•„ ì •ë³´ ğŸŒ¸</h2>
            <p>ìœ ì € ì´ë¦„ : {{ user_name }}</p>
            <p>ë¦¬ë·° ì‘ì„± ê°œìˆ˜: {{ reviews|length }}</p>
        </section>
        <section>
            <section>
                <h2>ğŸ’– ì‘ì„±í•œ ë¦¬ë·° ğŸ’–</h2>
                <!-- ë¦¬ë·° ì¶”ê°€ ë²„íŠ¼ -->
                <button id="addReviewBtn">âœï¸ ë¦¬ë·° ì¶”ê°€ âœï¸</button>
                <section class="review-list">
                    {% if reviews %}
                    <table class="review-table">
                        <thead>
                            <tr>
                                <th>Movie Title</th>
                                <th>Comment</th>
                                <th>Review Date</th>
                                <th>Watched Date</th>
                                <th> rating </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for review in reviews %}
                            <tr>
                                <td>{{ review['movie_title'] }}</td>
                                <td>{{ review['comment'] }}</td>
                                <td>{{ review['reviewDate'] }}</td>
                                <td>{{ review['watchedDate'] }}</td>
                                <td>{{ review['rating'] }} / 10</td>
                                <td>
                                    <!-- ìˆ˜ì • ë²„íŠ¼ -->
                                    <button class="edit-btn" data-review-id="{{ review['reviewID'] }}">ìˆ˜ì •</button>

                                    <!-- ì‚­ì œ ë²„íŠ¼ -->
                                    <form action="{{ url_for('delete_review') }}" method="post" style="display:inline;">
                                        <input type="hidden" name="review_id" value="{{ review['reviewID'] }}">
                                        <input type="hidden" name="user_name" value="{{ user_name }}">
                                        <input type="hidden" name="redirect_url" value="{{ request.path }}">
                                        <!-- í˜„ì¬ í˜ì´ì§€ URL -->
                                        <button type="submit" class="btn-delete"
                                            onclick="return confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                            ì‚­ì œ
                                        </button>
                                    </form>

                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p class="no-reviews">ì‘ì„±í•œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤. ğŸ˜¢</p>
                    {% endif %}
                </section>


    </main>

    <script>
        document.getElementById("addReviewBtn").addEventListener("click", function () {
            const username = "{{ user_name }}";  // ë¶€ëª¨ ì°½ì—ì„œ ì‚¬ìš©ì ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            const popup = window.open(
                `/review/popup?username=${encodeURIComponent(username)}`,
                "ë¦¬ë·° ì¶”ê°€",
                "width=500,height=600"
            );
            if (popup) {
                popup.focus();
            } else {
                alert("íŒì—…ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒì—… ì°¨ë‹¨ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.");
            }
        });

        document.querySelectorAll('.edit-btn').forEach(button => {
            button.addEventListener('click', function (e) {
                e.preventDefault();
                const reviewId = this.dataset.reviewId;
                const popup = window.open(
                    `/review/edit?review_id=${reviewId}`,
                    "ë¦¬ë·° ìˆ˜ì •",
                    "width=500,height=600"
                );
                popup.focus();
            });
        });

    </script>


</body>

</html>